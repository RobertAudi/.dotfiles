#!/usr/bin/env zsh

function main {
  local scripts_dir
  scripts_dir="${DOTFILES_DIR:-${HOME}/.dotfiles}/setup"

  if [[ ! -d "$scripts_dir" ]]; then
    # print error
    return 1
  fi

  local -A script_aliases

  script_aliases[cargo]=cargo-packages
  script_aliases[cpan]=cpan-packages
  script_aliases[go]=go-packages
  script_aliases[npm]=npm-packages
  script_aliases[gem]=ruby-gems
  script_aliases[pip]=pip-packages
  script_aliases[nvim]=neovim

  local setup_script

  if [[ -x "${scripts_dir}/${1}.setup.sh" ]]; then
    setup_script="${scripts_dir}/${1}.setup.sh"
  elif [[ -x "${scripts_dir}/${script_aliases[$1]}.setup.sh" ]]; then
    setup_script="${scripts_dir}/${script_aliases[$1]}.setup.sh"
  else
    # print error
    return 1
  fi

  if ! [[ -f "$setup_script" && -s "$setup_script" ]]; then
    # print error
    return 1
  fi

  $=setup_script "$@"
}

main "$@"
