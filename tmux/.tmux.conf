set-option -gq default-shell $SHELL

# For macOS only
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
set-option -gq default-command "reattach-to-user-namespace -l ${SHELL}"

# Default terminal
set-option -g default-terminal "xterm-256color"
set-option -sa terminal-overrides ",*256col*:Tc"

# The prefix
unbind C-b
set-option -g prefix C-s

# Immediate escape
set-option -sg escape-time 1

# Show status line messages for 4 second
set-option -g display-time 4000

# Show pane numbers for 2 second
set -g display-panes-time 2000

# Don't show a message for any activity type
set-option -g visual-activity off
set-option -g visual-bell     off
set-option -g visual-silence  off
set-option -g bell-action     none

# FocusGained and FocusLost autocommand events for vim + Tmux.
set-option -g focus-events on

# don't detach tmux when killing a session
set-option -g detach-on-destroy off

# Set window notifications
# Watch for activity in windows and highlight in status bar
set-window-option -g monitor-activity on

# Base index
set-option        -g base-index      1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# History
set-option -g history-limit 30000

# Rename windows automatically
set-window-option -g automatic-rename on

# Don't set terminal titles automatically
set-option -g set-titles off

# Vi mode
set-window-option -g mode-keys vi

# The Mouse
set-option -g -q mouse on

# Move windows. Taken from here:
# http://superuser.com/questions/343572/how-do-i-reorder-tmux-windows/552493#552493
bind-key -n C-S-Left  swap-window -t -1
bind-key -n C-S-Right swap-window -t +1

# Splits
bind-key _ split-window -v
bind-key | split-window -h

# resize panes like vim
# feel free to change the "1" to however many lines you want to resize by, only
# one at a time can be slow
bind-key -r < resize-pane -L 2
bind-key -r > resize-pane -R 2
bind-key -r - resize-pane -D 2
bind-key -r + resize-pane -U 2

# Fucking typos
bind-key C-[ copy-mode

# source .tmux.conf file
bind-key r source-file ~/.tmux.conf \; display-message " ✱ tmux.conf is reloaded"

# Look up in a man-page
bind-key m command-prompt -p "Man:" "split-window 'man %%'"

# Don't have to delete the current window name before renaming
bind , command-prompt -p "rename window:" "rename-window '%%'"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Focus/Unfocus current pane
bind-key C-s resize-pane -Z

# Clear fix
bind-key C-k send-keys "C-k"
bind-key C-l send-keys "C-l"

# Next/Previous window
bind-key C-n next-window
bind-key C-p previous-window

# Last window
bind-key o last-window

# Copy mode
bind-key -T copy-mode-vi WheelDownPane    select-pane \; send-keys -X -N 5 scroll-down
bind-key -T copy-mode-vi WheelUpPane      select-pane \; send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line
bind-key -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word
bind-key -T copy-mode-vi PPage            select-pane \; send-keys -X page-up
bind-key -T copy-mode-vi NPage            select-pane \; send-keys -X page-down
bind-key -T root         PPage         if-shell  -F      "#{alternate_on}" "send-keys PPage" "copy-mode; send-keys PPage"
bind-key -T root         WheelUpPane   if-shell  -F -t = "#{alternate_on}" "send-keys -M"    "select-pane -t =; copy-mode; send-keys -M"
bind-key -T root         WheelDownPane if-shell  -F -t = "#{alternate_on}" "send-keys -M"    "select-pane -t =; send-keys -M"

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi V send-keys -X select-line
bind-key -T copy-mode-vi Y send-keys -X copy-pipe "reattach-to-user-namespace pbcopy"
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
bind-key -T copy-mode-vi o send-keys -X copy-pipe-and-cancel "xargs open"
bind-key -T copy-mode-vi O send-keys -X copy-pipe-and-cancel "xargs open --background"

# Status bar
set-option -g status on

set-option -g status-left           "  #S  "
set-option -g status-left-style     "bg=black,fg=brightblack"
set-option -g status-left-length    60

set-option -g status-right " %a #[fg=brightwhite]%H:%M #[fg=brightblack] %d/%m/%Y #[default]"
set-option -g status-right-style  "bg=black,fg=brightblack"
set-option -g status-right-length 60

set-option -g pane-border-style          "fg=brightblack"
set-option -g pane-active-border-style   "fg=brightblack"

set-option -g message-style   "bg=blue,fg=black"

set-window-option -g status-style   "bg=black"
set-window-option -g mode-style     "fg=black,bg=brightblack"

# Window separator
set-window-option -g window-status-separator "#[fg=brightblack]┊#[fg=default]"

set-window-option -g window-status-format    " #I:#W "
set-window-option -g window-status-style     "fg=brightblack"

set-window-option -g window-status-current-format   " #[fg=yellow]#I:#[fg=white]#W "
set-window-option -g window-status-current-style    "bg=black"

set-window-option -g window-status-bell-style       "fg=red"
set-window-option -g window-status-activity-style   "fg=blue"

# ------------------------------------------------------------------------------

run-shell ~/.tmux/prefix_highlight.sh
run-shell ~/.tmux/direnv.sh
