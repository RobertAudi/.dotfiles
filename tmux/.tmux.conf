set-option -gq default-shell $SHELL

# For macOS only
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
set-option -gq default-command "reattach-to-user-namespace -l ${SHELL}"

# Default terminal
set-option -g default-terminal "screen-256color"
set-option -sa terminal-overrides ",*256col*:Tc"

# Options {{{
# ------------------------------------------------------------------------------

# Don't set terminal titles automatically
set-option -g set-titles off

# Immediate escape
set-option -sg escape-time 1

# Show status line messages for 4 second
set-option -g display-time 4000

# Show pane numbers for 2 second
set -g display-panes-time 2000

# Don't show a message for any activity type
set-option -g visual-activity off
set-option -g visual-bell     off
set-option -g visual-silence  off
set-option -g bell-action     none

# FocusGained and FocusLost autocommand events for vim + Tmux.
set-option -g focus-events on

# don't detach tmux when killing a session
set-option -g detach-on-destroy off

# Set window notifications
# Watch for activity in windows and highlight in status bar
set-window-option -g monitor-activity on

# Base index
set-option        -g base-index      1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# History
set-option -g history-limit 30000

# Rename windows automatically
set-window-option -g automatic-rename on

# The Mouse
set-option -g -q mouse on

# Vi mode
set-window-option -g mode-keys vi

# Wrap search
set-window-option -g wrap-search on

# ------------------------------------------------------------------------------ }}}

# Status bar {{{
# ------------------------------------------------------------------------------

set-option -g status on
set-option -g status-position bottom

# @see https://github.com/tmux/tmux/issues/108
set-option -g status-interval 0

# ------------------------------------------------------------------------------ }}}

# Key bindings {{{
# ------------------------------------------------------------------------------

# remove all keybindings
unbind-key -a  -T root
unbind-key -a  -T prefix
unbind-key -a  -T copy-mode-vi

# The prefix
set-option -g prefix C-s

# List key bindings
bind-key -T prefix ? list-keys

# Open the command prompt
bind-key -T prefix : command-prompt

# Detach client
bind-key -T prefix d detach-client

# Copy & paste {{{
# ------------------------------------------------------------------------------

# Enter copy-mode
bind-key -T prefix Escape copy-mode

# Exit copy-mode
bind-key -T copy-mode-vi q   send-keys -X cancel

# Start selection
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Start line-wise selection
bind-key -T copy-mode-vi V send-keys -X select-line

# Start block-wise selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Stop selection (ie: exit visual mode)
bind-key -T copy-mode-vi Escape send-keys -X clear-selection

# Double click (mouse) to select word
bind-key -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word

# Triple click (mouse) to select line
bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line

# Movements (same as vim) {{{
# ------------------------------------------------------------------------------

bind-key -T copy-mode-vi  h  send-keys -X cursor-left
bind-key -T copy-mode-vi  j  send-keys -X cursor-down
bind-key -T copy-mode-vi  k  send-keys -X cursor-up
bind-key -T copy-mode-vi  l  send-keys -X cursor-right

bind-key -T copy-mode-vi  b  send-keys -X previous-word
bind-key -T copy-mode-vi  B  send-keys -X previous-space

bind-key -T copy-mode-vi  e  send-keys -X next-word-end
bind-key -T copy-mode-vi  E  send-keys -X next-space-end

bind-key -T copy-mode-vi  w  send-keys -X next-word
bind-key -T copy-mode-vi  W  send-keys -X next-space

bind-key -T copy-mode-vi  g  send-keys -X history-top
bind-key -T copy-mode-vi  G  send-keys -X history-bottom

bind-key -T copy-mode-vi C-u send-keys -X halfpage-up
bind-key -T copy-mode-vi C-d send-keys -X halfpage-down

bind-key -T copy-mode-vi  0  send-keys -X start-of-line
bind-key -T copy-mode-vi  ^  send-keys -X back-to-indentation
bind-key -T copy-mode-vi '$' send-keys -X end-of-line

bind-key -T copy-mode-vi  H  send-keys -X back-to-indentation
bind-key -T copy-mode-vi  L  send-keys -X end-of-line

bind-key -T copy-mode-vi  /  command-prompt -p "(search down)" "send -X search-forward \"%%%\""
bind-key -T copy-mode-vi  ?  command-prompt -p "(search up)" "send -X search-backward \"%%%\""

bind-key -T copy-mode-vi  n  send-keys -X search-again
bind-key -T copy-mode-vi  N  send-keys -X search-reverse

# Scroll up & down
bind-key -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 5 scroll-down
bind-key -T copy-mode-vi WheelUpPane   select-pane \; send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi PPage         select-pane \; send-keys -X page-up
bind-key -T copy-mode-vi NPage         select-pane \; send-keys -X page-down

# Enter copy-mode then Scroll up & down
bind-key -T root PPage         if-shell  -F      "#{alternate_on}" "send-keys PPage" "copy-mode; send-keys PPage"
bind-key -T root WheelUpPane   if-shell  -F -t = "#{alternate_on}" "send-keys -M"    "select-pane -t =; copy-mode; send-keys -M"
bind-key -T root WheelDownPane if-shell  -F -t = "#{alternate_on}" "send-keys -M"    "select-pane -t =; send-keys -M"

# ------------------------------------------------------------------------------ }}}

# Copy selection and exit copy mode
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# Copy selection and stay in copy mode
bind-key -T copy-mode-vi Y send-keys -X copy-pipe "reattach-to-user-namespace pbcopy"

# Open selection
bind-key -T copy-mode-vi o send-keys -X copy-pipe-and-cancel "xargs open"

# Open selection in the background
bind-key -T copy-mode-vi O send-keys -X copy-pipe-and-cancel "xargs open --background"

# ------------------------------------------------------------------------------ }}}

# Sessions, Windows & Panes {{{
# ------------------------------------------------------------------------------

# Move windows
bind-key -r S-Left  swap-window -t -1
bind-key -r S-Right swap-window -t +1

# Show pane indices
bind-key -T prefix Space display-panes

# Rename the current window
bind-key -T prefix r command-prompt -p "rename window:" "rename-window -- '%%'"

# Rename the current session
bind-key -T prefix R command-prompt -p "rename session:" "rename-session -- '%%'"

# Splits {{{
# ------------------------------------------------------------------------------

# Vertical split
bind-key _ split-window -v

# Horizontal split
bind-key | split-window -h

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# ------------------------------------------------------------------------------ }}}

# resize panes like vim
# feel free to change the "1" to however many lines you want to resize by, only
# one at a time can be slow
bind-key -r < resize-pane -L 2
bind-key -r > resize-pane -R 2
bind-key -r - resize-pane -D 2
bind-key -r + resize-pane -U 2

# Focus/Unfocus current pane
bind-key C-s resize-pane -Z

# New window
bind-key -T prefix c new-window

# Go to window by number
bind-key -T prefix 1 select-window -t :=1
bind-key -T prefix 2 select-window -t :=2
bind-key -T prefix 3 select-window -t :=3
bind-key -T prefix 4 select-window -t :=4
bind-key -T prefix 5 select-window -t :=5
bind-key -T prefix 6 select-window -t :=6
bind-key -T prefix 7 select-window -t :=7
bind-key -T prefix 8 select-window -t :=8
bind-key -T prefix 9 select-window -t :=9

# Next/Previous window
bind-key -r C-n next-window
bind-key -r C-p previous-window

# Last window
bind-key o last-window

# Move pane to separate window
bind-key -T prefix * break-pane

# ------------------------------------------------------------------------------ }}}

# source .tmux.conf file
bind-key C-r source-file ~/.tmux.conf \; display-message " ✱ tmux.conf is reloaded"

# Look up in a man-page
bind-key m command-prompt -p "Man:" "split-window 'man %%'"

# Clear fix
bind-key C-k send-keys "C-k"
bind-key C-l send-keys "C-l"

# ------------------------------------------------------------------------------ }}}

# Appearance {{{
# ------------------------------------------------------------------------------

# Status bar {{{
# ------------------------------------------------------------------------------

set-option -g status-style "bg=#2b2b2b"

set-option -g status-left         "  #S  "
set-option -g status-left-style   "fg=#5a647e,bg=#2b2b2b"
set-option -g status-left-length  60

set-option -g status-right        " %a #[fg=#f9f7f3]%H:%M #[fg=#5a647e] %d/%m/%Y #[default]"
set-option -g status-right-style  "fg=#5a647e,bg=#2b2b2b"
set-option -g status-right-length 60

# ------------------------------------------------------------------------------ }}}

# Panes {{{
# ------------------------------------------------------------------------------

set-option -g pane-border-style          "fg=#5a647e"
set-option -g pane-active-border-style   "fg=#5a647e"

# ------------------------------------------------------------------------------ }}}

# Messages {{{
# ------------------------------------------------------------------------------

set-option -g message-style   "fg=#2b2b2b,bg=#6d9cbe"

# ------------------------------------------------------------------------------ }}}

# Mode {{{
# ------------------------------------------------------------------------------

set-window-option -g mode-style     "fg=#2b2b2b,bg=#5a647e"

# ------------------------------------------------------------------------------ }}}

# Window {{{
# ------------------------------------------------------------------------------

set-window-option -g window-status-separator "#[fg=#5a647e]┊#[fg=default]"
set-window-option -g window-status-bell-style       "fg=#da4939"
set-window-option -g window-status-activity-style   "fg=#6d9cbe"

set-window-option -g window-status-format    " #I:#W "
set-window-option -g window-status-style     "fg=#5a647e"

set-window-option -g window-status-current-format   " #[fg=#ffc66d]#I:#[fg=#e6e1dc]#W "
set-window-option -g window-status-current-style    "bg=#2b2b2b"

# ------------------------------------------------------------------------------ }}}

# ------------------------------------------------------------------------------ }}}

# Plugins {{{
# ------------------------------------------------------------------------------

run-shell $XDG_DATA_HOME/tmux/plugins/prefix_highlight.sh
run-shell $XDG_DATA_HOME/tmux/plugins/direnv.sh

# ------------------------------------------------------------------------------ }}}

# Modeline {{{
# vim: set foldmarker={{{,}}} foldlevel=0 foldmethod=marker : }}}
